version: 2.1

jobs:
  interactive_shell:
    docker:
      - image: quay.io/droidian/build-essential:trixie-amd64 
    steps:
      - checkout
      - run:
          name: Install tmate and Locale
          command: |
            apt-get update
            apt-get install -y tmate curl wget locales build-essential libncurses-dev curl wget bc bison flex zip unzip ccache clang llvm lld libssl-dev git
            echo "en_US.UTF-8 UTF-8" > /etc/locale.gen
            locale-gen en_US.UTF-8
            update-locale LANG=en_US.UTF-8 LC_ALL=en_US.UTF-8
      - run:
          name: Start tmate session
          command: |
            export LC_ALL=en_US.UTF-8
            export LANG=en_US.UTF-8
            export LANGUAGE=en_US.UTF-8
            tmate -S /tmp/tmate.sock new-session -d
            tmate -S /tmp/tmate.sock wait tmate-ready
            TMATE_SSH=$(tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}')
            echo "SSH: ${TMATE_SSH}"
            while true; do 
              echo "Keeping tmate session alive..."
              sleep 300
              tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}'
            done

workflows:
  version: 2
  interactive_debugging:
    jobs:
      - interactive_shell
